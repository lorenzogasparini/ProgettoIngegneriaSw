<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Font?>
<?import javafx.scene.image.ImageView?>
<?import javafx.geometry.Insets?>

<VBox xmlns="http://javafx.com/javafx/17"
      xmlns:fx="http://javafx.com/fxml/1"
      fx:controller="com.progettoingegneriasw.controller.GestioneUtentiController">

    <BorderPane VBox.vgrow="ALWAYS">
        <center>
            <HBox alignment="CENTER" spacing="10" VBox.vgrow="ALWAYS" HBox.hgrow="ALWAYS">
                <padding>
                    <Insets top="20" right="20" bottom="20" left="20"/>
                </padding>

                <!-- Left Panel: User Table -->
                <VBox alignment="CENTER" spacing="10" VBox.vgrow="ALWAYS" HBox.hgrow="ALWAYS">
                    <VBox alignment="CENTER" spacing="10" prefHeight="300" prefWidth="400"
                          styleClass="card, container" VBox.vgrow="ALWAYS" HBox.hgrow="ALWAYS">
                        <Label text="Lista utenti" textAlignment="CENTER">
                            <font>
                                <Font name="System Bold" size="24.0" />
                            </font>
                            <VBox.margin>
                                <Insets bottom="20.0" />
                            </VBox.margin>
                        </Label>

                        <TableView fx:id="tableView" VBox.vgrow="ALWAYS">
                            <columns>
                                <TableColumn prefWidth="100.0" text="Username" fx:id="username" />
                                <TableColumn prefWidth="100.0" text="Nome" fx:id="nome" />
                                <TableColumn prefWidth="100.0" text="Cognome" fx:id="cognome" />
                                <TableColumn prefWidth="100.0" text="Email" fx:id="email" />
                            </columns>
                        </TableView>

                        <padding>
                            <Insets top="20.0" right="20.0" bottom="20.0" left="20.0" />
                        </padding>
                    </VBox>
                </VBox>

                <!-- Right Panel: User Detail Scrollable -->
                <ScrollPane fx:id="ScrollPaneGestioneUtente"
                            HBox.hgrow="ALWAYS"
                            fitToWidth="true"
                            prefHeight="600"
                            prefWidth="300"
                            visible="false"
                            managed="false"
                            styleClass="card, container">

                    <content>
                            <VBox fx:id="VBoxGestioneUtente"
                                  alignment="CENTER"
                                  spacing="10"
                                  prefHeight="600"
                                  prefWidth="300"
                                  styleClass="card, container"
                                  visible="false"
                                  managed="false">

                                <Label text="Gestione utente" textAlignment="CENTER">
                                    <font>
                                        <Font name="System Bold" size="24.0" />
                                    </font>
                                    <VBox.margin>
                                        <Insets bottom="20.0" />
                                    </VBox.margin>
                                </Label>

                                <Label fx:id="statusLabel"
                                       styleClass="alert-danger"
                                       text="Status message goes here"
                                       wrapText="true"
                                       visible="false"
                                       managed="true">
                                    <VBox.margin>
                                        <Insets bottom="10.0" />
                                    </VBox.margin>
                                </Label>

                                <HBox alignment="CENTER_LEFT" spacing="10" HBox.hgrow="ALWAYS">
                                    <VBox alignment="CENTER" spacing="10">
                                        <ImageView fx:id="profileImage"
                                                   fitHeight="200" fitWidth="200"
                                                   preserveRatio="true"
                                                   styleClass="profile-image" />
                                    </VBox>
                                    <VBox alignment="TOP_RIGHT" HBox.hgrow="ALWAYS">
                                        <Button fx:id="deleteButton"
                                                onAction="#handleDeleteUtente"
                                                style="-fx-background-color: #d9534f; -fx-text-fill: white;"
                                                prefHeight="20" prefWidth="20">
                                            <VBox.margin>
                                                <Insets right="20" top="10" />
                                            </VBox.margin>
                                        </Button>
                                    </VBox>
                                </HBox>

                                <!-- Update User Fields -->
                                <VBox spacing="10" fx:id="updateUserBox" visible="false" managed="false">
                                    <Label text="Modifica dati utente" styleClass="form-label" />

                                    <TextField fx:id="updateNomeField" promptText="Nome" />
                                    <TextField fx:id="updateCognomeField" promptText="Cognome" />
                                    <PasswordField fx:id="updatePasswordField" promptText="Password" />

                                    <VBox fx:id="medicoFieldsBox" spacing="10" visible="false" managed="false">
                                        <TextField fx:id="updateEmailMedicoField" promptText="Email" />
                                    </VBox>

                                    <VBox fx:id="pazienteFieldsBox" spacing="10" visible="false" managed="false">
                                        <ComboBox fx:id="updateDiabetologoComboBox" promptText="Diabetologo di riferimento" />
                                        <DatePicker fx:id="updateDataNascitaPicker" promptText="Data di nascita" />
                                        <TextField fx:id="updateEmailPazienteField" promptText="Email" />
                                        <TextField fx:id="updatePesoField" promptText="Peso" />
                                        <TextField fx:id="updateProvinciaField" promptText="Provincia" />
                                        <TextField fx:id="updateComuneField" promptText="Comune" />
                                        <TextArea fx:id="updateNotePazienteField" promptText="Note" />
                                    </VBox>

                                    <Button text="Salva modifiche" onAction="#handleUpdateUser" />
                                </VBox>
                                <padding>
                                    <Insets top="20.0" right="20.0" bottom="20.0" left="20.0" />
                                </padding>
                            </VBox>
                    </content>
                </ScrollPane>
            </HBox>
        </center>
    </BorderPane>
</VBox>
